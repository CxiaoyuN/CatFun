name: iOS Debug 打包

on:
  push:
    branches: [main]  # 触发分支，可自定义
  pull_request:
    branches: [main]
  workflow_dispatch:  # 手动触发

jobs:
  build-ios:
    runs-on: macos-latest  # 必须用 macOS 虚拟机
    steps:
      - name: 拉取代码
        uses: actions/checkout@v4

      - name: 配置 Xcode 版本
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable  # 使用最新稳定版 Xcode

      - name: 安装依赖（CocoaPods）
        run: |
          cd ios  # 进入 iOS 项目目录（根据实际路径调整）
          pod install --repo-update

      - name: 构建并打包 IPA
        run: |
          cd ios
          # 清理构建缓存
          xcodebuild clean -workspace ${{ secrets.XCODE_WORKSPACE }} -scheme ${{ secrets.XCODE_SCHEME }} -configuration Debug
          # 构建并导出 IPA
          xcodebuild archive -workspace ${{ secrets.XCODE_WORKSPACE }} -scheme ${{ secrets.XCODE_SCHEME }} -configuration Debug -archivePath ./build/CatFun.xcarchive
          xcodebuild -exportArchive -archivePath ./build/CatFun.xcarchive -exportPath ./build/ipa -exportOptionsPlist ./ExportOptions.plist

      - name: 上传 IPA 产物
        uses: actions/upload-artifact@v4
        with:
          name: ios-debug-ipa
          path: ios/build/ipa/*.ipa  # 产物路径（根据实际调整）
          retention-days: 7  # 产物保留天数
